<app-navbar></app-navbar>

<div class="page-container" style="height: auto; min-height: 100vh;display: flex; flex-direction: column">
  <section class="acoes-topo" style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center; justify-content: space-between;">
    <div>
      <button class="btn btn-sec " (click)="voltar()" title="Voltar">
        <i class="pi pi-arrow-left"></i> Voltar
      </button>
    </div>
  </section>

  <div class="container">
    <h2>Gerenciar Carregamentos</h2>

    <div *ngIf="loading" class="loading">
      Carregando carregamentos...
    </div>

    <!-- LISTA DE CARREGAMENTOS (paginada) -->
    <div class="carregamento-card"
      *ngFor="let carregamento of carregamentosPaginados; trackBy: trackByCarregamento">

    <!-- Cabe√ßalho -->
    <div class="carregamento-header"
       (click)="toggleCaminhao(carregamento.id)">
      <div class="header-main">
        <h3>Carregamento #{{ carregamento.id }} ‚óè
        <small>Criado em {{ carregamento?.dataCriacao | date:'dd/MM/yyyy HH:mm' }}</small></h3>
        <span class="chip">üóÇÔ∏è {{ carregamento?.pedidos?.length ?? 0 }} pedidos</span>
      </div>
      <div class="header-meta">
        <button class="btn-visualizar" (click)="visualizarCarregamento(carregamento.id)"> <i class="pi pi-eye" style="margin-right: 10px ;"></i> Visualizar</button>
        <span class="caret">
          {{ isCaminhaoAberto(carregamento.id) ? '‚ñ≤' : '‚ñº' }}
        </span>
      </div>
    </div>

    <!-- Detalhes -->
    <div class="carregamento-detalhes" *ngIf="isCaminhaoAberto(carregamento.id)">
      <div class="grid-info">
        <p><strong>Dimens√µes:</strong> {{ carregamento?.caminhao?.comprimento }} √ó {{ carregamento?.caminhao?.largura }} √ó {{ carregamento?.caminhao?.altura }} m</p>
        <p><strong>Peso limite:</strong> {{ carregamento?.caminhao?.pesoLimite | number:'1.0-0' }} kg</p>
      </div>

      <!-- Pedidos -->
      <div class="pedido-card"
          *ngFor="let pedido of carregamento?.pedidos; trackBy: trackByPedido">
        <div class="pedido-header" (click)="togglePedido(carregamento.id, pedido?.id ?? -1)">
          üì¶ {{ pedido?.descricao || ('Pedido #' + pedido?.id) }}

          <div class="header-meta">
            <span class="pedido-info">
              Itens: {{ contarItensPedido(pedido) }} ‚Ä¢
              Peso: {{ calcularPesoPedido(pedido) | number:'1.0-0' }} kg
            </span>
            <span class="caret">
              {{ isPedidoAberto(carregamento.id, pedido.id) ? '‚ñ≤' : '‚ñº' }}
            </span>
          </div>
        </div>

        <!-- Pacotes -->
        <div class="pacote-wrapper" *ngIf="isPedidoAberto(carregamento.id, pedido?.id ?? -1)">
          <table class="pacote-tabela">
            <thead>
              <tr><th>Nome</th><th>Dimens√µes</th><th>Peso</th><th>Qtd</th><th>Fr√°gil</th></tr>
            </thead>
            <tbody>
              <tr *ngFor="let pacote of pedido?.pacotes; trackBy: trackByPacote">
                <td>{{ pacote?.nome }}</td>
                <td>{{ pacote?.comprimento }} √ó {{ pacote?.largura }} √ó {{ pacote?.altura }}</td>
                <td>{{ pacote?.peso }}</td>
                <td>{{ pacote?.quantidade }}</td>
                <td [class.fragil]="pacote?.fragil">{{ pacote?.fragil ? 'Fr√°gil' : '‚Äî' }}</td>
              </tr>
            </tbody>
          </table>

          <!-- Vers√£o mobile da tabela -->
          <div class="pacote-lista">
            <div class="pacote-item" *ngFor="let pacote of pedido?.pacotes; trackBy: trackByPacote">
              <p><strong>{{ pacote?.nome }}</strong></p>
              <p>Dimens√µes: {{ pacote?.comprimento }}m √ó {{ pacote?.largura }}m √ó {{ pacote?.altura }}m</p>
              <p>Peso: {{ pacote?.peso }} kg  ‚Ä¢  Qtd: {{ pacote?.quantidade }}</p>
              <p class="fragil" [class.fragil-true]="pacote?.fragil">Fr√°gil: {{ pacote?.fragil ? 'Sim' : 'N√£o' }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- Pagina√ß√£o -->
<div class="paginacao" *ngIf="!loading && carregamentos?.length">
  <button type="button" (click)="paginaAnterior()" [disabled]="paginaAtual === 1">
    ‚óÄ Anterior
  </button>

  <ng-container *ngFor="let _ of [].constructor(totalPaginas); let i = index">
    <button type="button"
            [class.ativa]="(i + 1) === paginaAtual"
            (click)="irParaPagina(i + 1)">
      {{ i + 1 }}
    </button>
  </ng-container>

  <button type="button" (click)="proximaPagina()" [disabled]="paginaAtual === totalPaginas">
    Pr√≥xima ‚ñ∂
  </button>
</div>


    <div class="muted" *ngIf="!loading && !carregamentos?.length">
      Nenhum carregamento encontrado.
    </div>
  </div>
</div>

<app-screen-background></app-screen-background>
